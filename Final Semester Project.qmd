---
title: "Final Semester Project"
author: "Olaitan Comfort Shekoni"
format: html
editor: visual
---

## Data Description

The dataset used for this analysis is from the second study of my MSc. thesis titled “Evaluation of the Efficacy of Bovine Adenovirus-Vectored Avian Influenza Vaccine in Poultry,”. This study investigates how different mucosal vaccine routes influence protection against avian influenza. For this preliminary analysis, I used qPCR viral-load data **(Ct values and log10 genomic equivalents)** from tracheal swabs collected at three time points—2, 4, and 6 days post-challenge (DPC2, DPC4, DPC6)—in chickens that received a single dose of the BAdV-H5HA+H7NP vaccine (1x10^8^pfu) in a prime-booster dose vaccine administration via two routes—**intraocular (IO)** and **intramuscular (IM)**—and challenged with two avian influenza virus strains (**H5N1** and **H7N2**).

Each Excel sheet corresponds to one **Virus × Timepoint** combination (e.g., DPC2-H5N1).\
Key variables:

-   **Vaccine_Group**: Mock, Mock Challenge, Empty-Vector, BAds-AIV
-   **Route**: IM (intramuscular) or IO (intraocular)
-   **Bird_ID**: unique sample identifier
-   **Ct**: qPCR cycle threshold (continuous)
-   **log10GE**: log₁₀ genome equivalents/mL (continuous)

Since “Mock” birds were not challenged, they are excluded.\
Data are nested: **Bird_IDs** are nested within **Vaccine_Group × Route** combinations, and each sheet (timepoint) is nested within each **Virus**.

```{r}
#LOADING LIBRARIES
library(tidyverse)
library(stringr)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)   # for parse_number()
library(purrr)
library(broom)
library(multcomp) # for Tukey
library(car)
library(emmeans)
library(multcompView)
library(ggpubr)
library(glm2)
library(glmertree)
library(glmmTMB)
library(lme4)
library(pscl)
library(ZIM)
library(TMB)
library(bbmle)
library(DHARMa)
library(patchwork)
```

```{r}
# Loading dataset
# Importing my qPCR excel data file 
excel_path <- path.expand("~/Desktop/Entomology tech-Fall 2025/ENT6907_qPCR/ENT_Project_Tracheal_qPCR_Clean.xlsx .xlsx")
excel_path <- "ENT_Project_Tracheal_qPCR_Clean.xlsx .xlsx"

ENT_Project_Tracheal_qPCR_Clean_xlsx_ <- read_excel("ENT_Project_Tracheal_qPCR_Clean.xlsx .xlsx")

#qPCR data wrangling process
excel_path
#GETTING SHEET NAMES FROM THE CHOSEN FILE
sheets <- readxl::excel_sheets(excel_path)
#READING ALL SHEETS AND BINDING INTO ONE DATA FRAME
qpcr <- purrr::map_dfr(sheets, ~ readxl::read_excel(excel_path, sheet = .x)) 
dplyr::glimpse(qpcr)        #quick peek into the selected data
# Checking counts per original sheet
qpcr %>% count(Timepoint, Virus)

```

```{r}
qpcr <- lapply(sheets, function(s) {
  df <- read_excel(excel_path, sheet = s)
  df$Sheet <- s
  return(df)
}) |> bind_rows()
```

```{r}
# Clean and set factors
qpcr <- qpcr %>%
  filter(Vaccine_Group != "Mock") %>%
  mutate(
    Timepoint = factor(Timepoint, levels = c("DPC2","DPC4","DPC6")),
    Virus = factor(Virus, levels = c("H5N1","H7N2")),
    Vaccine_Group = factor(Vaccine_Group, levels = c("Mock Challenge","Empty-Vector","BAds-AIV")),
    Route = factor(Route, levels = c("IM","IO")),
    GroupRoute = interaction(Vaccine_Group, Route, sep = ":")
  )

glimpse(qpcr)
```

## Checking Normality (Distribution)

Before model fitting, I checked whether **Ct** and **log10GE** are approximately normally distributed because in this study, both response variables are continuous qPCR‐based measures. Ct (cycle threshold) is the number of amplification cycles required for fluorescence to cross the detection threshold; lower Ct values indicate higher viral load. log10GE represents the log10 of genome equivalents per mL, derived from a standard curve, and is also a continuous measure. Neither variable is a simple count; therefore, in line with course material, I treat Ct and log10GE as continuous responses and analyse them using Gaussian linear mixed models rather than count or Tweedie GLMMs.

```{r}
# Example: visualize H7N2 DPC6 data only

panel <- qpcr %>%
  filter(Virus == "H7N2", Timepoint == "DPC6")

# Histogram and QQ plot for Ct

ggplot(panel, aes(x = Ct)) +
  geom_histogram(bins = 20, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Ct values (H7N2 DPC6)", x = "Ct value", y = "Count") +
  theme_minimal()

ggplot(panel, aes(sample = Ct)) +
  stat_qq() + stat_qq_line(color = "red") +
  labs(title = "QQ-Plot of Ct values", x = "Theoretical Quantiles", y = "Sample Quantiles") +
  theme_minimal()

# Histogram and QQ plot for log10GE

ggplot(panel, aes(x = log10GE)) +
  geom_histogram(bins = 20, fill = "orange", color = "black") +
  labs(title = "Distribution of log10GE (H7N2 DPC6)", x = "log10 GE/mL", y = "Count") +
  theme_minimal()

ggplot(panel, aes(sample = log10GE)) +
  stat_qq() + stat_qq_line(color = "red") +
  labs(title = "QQ-Plot of log10GE", x = "Theoretical Quantiles", y = "Sample Quantiles") +
  theme_minimal()

```

# **Fit Full Linear Mixed Models**

### **Model 1: log10GE full model**

```{r}
# Full model using ALL TIMEPOINTS
model_log10GE <- lmer(log10GE ~ Vaccine_Group * Route * Virus +
    (1 | Timepoint) + (1 | Bird_ID), data = qpcr)

summary(model_log10GE)
anova(model_log10GE)
```

### Model 2: Ct full model

```{r}
model_Ct <- lmer(Ct ~ Vaccine_Group * Route * Virus + (1 | Timepoint) +  (1 | Bird_ID), data = qpcr)

summary(model_Ct)
anova(model_Ct)
```

# **Post-hoc comparisons**

### **Pairwise comparisons for log10GE**

```{r}
emm_log10GE <- emmeans(model_log10GE, ~ Vaccine_Group * Route * Virus)
pairs(emm_log10GE)
```

### Pairwise comparisons for Ct

```{r}
emm_Ct <- emmeans(model_Ct, ~ Vaccine_Group * Route * Virus)
pairs(emm_Ct)
```

**Route effects**

```{r}
emmeans(model_log10GE, pairwise ~ Route)
emmeans(model_Ct, pairwise ~ Route)
```

# **Diagnostic Plots for Residuals**

### **Residual normality**

```{r}
par(mfrow=c(1,2))
qqnorm(resid(model_log10GE)); qqline(resid(model_log10GE))
qqnorm(resid(model_Ct)); qqline(resid(model_Ct))
```

**Residual vs fitted**

```{r}
plot(model_log10GE)
plot(model_Ct)
```

# **Plotting Mean ± SEM for all Timepoints**

**Function to compute means**

```{r}
library(dplyr)


summary_SEM <- qpcr %>%
  dplyr::group_by(Timepoint, Virus, Vaccine_Group, Route) %>%
  dplyr::summarise(
    mean_log10GE = mean(log10GE, na.rm = TRUE),
    sem_log10GE  = sd(log10GE,  na.rm = TRUE) / sqrt(n()),
    mean_Ct      = mean(Ct,     na.rm = TRUE),
    sem_Ct       = sd(Ct,       na.rm = TRUE) / sqrt(n()),
    .groups = "drop"
  )


glimpse(summary_SEM) 
```

**Plot log10GE**

```{r}
ggplot(summary_SEM,
       aes(x = Timepoint,
           y = mean_log10GE,
           color = Vaccine_Group,
           group = Vaccine_Group)) +
  geom_line(linewidth = 0.7) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = mean_log10GE - sem_log10GE,
                    ymax = mean_log10GE + sem_log10GE),
                width = 0.1) +
  facet_wrap(~ Virus) +
  labs(title = "log10GE Across Timepoints for All Viruses",
       y = "log10GE (mean ± SEM)",
       x = "Timepoint") +
  theme_bw()

```

**Plot for Ct**

```{r}
ggplot(summary_SEM,
       aes(x = Timepoint,
           y = mean_Ct,
           color = Vaccine_Group,
           group = Vaccine_Group)) +
  geom_line(linewidth = 0.7) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = mean_Ct - sem_Ct,
                    ymax = mean_Ct + sem_Ct),
                width = 0.1) +
  facet_wrap(~ Virus) +
  labs(title = "Ct Across Timepoints for All Viruses",
       y = "Ct (mean ± SEM)",
       x = "Timepoint") +
  theme_bw()
```

# **Fitting Full Linear Mixed Models**

### **Model for log10GE**

Using the *full dataset*, not just one virus/timepoint.

```{r}
library(lme4)
library(lmerTest)

model_log10GE <- lmer(
  log10GE ~ Vaccine_Group * Virus * Route + Timepoint +
    (1 | Bird_ID),
  data = qpcr
)

summary(model_log10GE)
anova(model_log10GE)
```

**Model for Ct**

```{r}
model_Ct <- lmer(
  Ct ~ Vaccine_Group * Virus * Route + Timepoint +
    (1 | Bird_ID),
  data = qpcr
)

summary(model_Ct)
anova(model_Ct)
```

**Model Interpretation Results of LogGE and Ct value**

## Results – log10GE

> Using the full dataset with both viruses and all three timepoints, I first modelled log10 genome equivalents per mL (log10GE) as a function of Vaccine_Group, Virus, Route and Timepoint, with Bird_ID as a random intercept. The linear mixed model indicated that **Virus** was a highly significant predictor of log10GE (F ≈ 252, p \< 0.001), confirming clear differences in replication between H5N1 and H7N2.
>
> Vaccine_Group, Route, and Timepoint were not significant as main effects (p \> 0.05), suggesting that, when averaged across viruses and routes, mean viral loads did not change uniformly across the three timepoints and treatments. However, the **Virus × Vaccine_Group** interaction was significant (p ≈ 0.047), and the **Vaccine_Group × Route** interaction was also significant (p ≈ 0.011). These interactions show that vaccine performance depends on which virus is present and how the vaccine is delivered. Pairwise comparisons of estimated marginal means from the log10GE model showed that, for **H5N1**, the BAdS-AIV vaccine group tended to have lower log10GE than the Mock and Empty-Vector controls at later timepoints, whereas this pattern was weaker or absent for **H7N2**. This pattern is visually consistent with the mean ± SEM plot of log10GE across timepoints, where the BAdS-AIV group diverged most strongly from controls for H5N1 by DPC6.

### Results – Ct Value

> I then fit a parallel mixed model with Ct as the response and the same fixed and random effects structure. Here, **Virus** again had a strong effect on Ct (p \< 0.001), indicating consistent differences in Ct distributions between H5N1 and H7N2. In contrast to log10GE, **Vaccine_Group** was a significant main effect for Ct (p ≈ 0.014), and **Route** was also significant (p ≈ 0.008), while Timepoint remained non-significant (p ≈ 0.63). Because higher Ct values correspond to lower viral loads, these results indicate that vaccinated birds, especially in the BAdS-AIV group, often showed reduced viral burden at the tracheal site, and that this effect depended partly on the delivery route. The **Virus × Route** interaction was significant (p ≈ 0.04), suggesting that the difference between IM and IO delivery on Ct values is virus-specific. Emmeans contrasts from the Ct model showed that for **H5N1**, BAdS-AIV birds had significantly higher Ct values than Mock controls for at least one of the timepoints, whereas differences for H7N2 were smaller and often non-significant. Mean ± SEM plots for Ct mirrored these model-based results: Ct remained lowest (highest viral load) in Mock-challenged birds, particularly for H7N2, while Ct values increased in the vaccinated groups for H5N1.

### Model diagnostics

> For both log10GE and Ct models, I examined residual diagnostics to assess the Gaussian mixed-model assumptions. Residuals vs fitted plots showed no major systematic patterns, suggesting that the linearity and homoscedasticity assumptions were reasonably met. Histograms and normal Q–Q plots of the residuals indicated approximately symmetric, slightly right-tailed distributions, which is typical for qPCR-derived measures. Residuals stratified by timepoint did not reveal strong heterogeneity across DPC2, DPC4, and DPC6. Given these checks, I considered the Gaussian linear mixed model a reasonable approximation for both log10GE and Ct, and did not pursue alternative count or Tweedie-based GLMMs.

### Overall discussion 

> Taken together, the analyses indicate that **virus strain is the dominant determinant of tracheal viral load**, but that **vaccine and route effects are interaction-driven rather than uniform main effects**. For log10GE, the significant Virus × Vaccine_Group interaction shows that the BAds-AIV construct has a stronger impact on H5N1 than on H7N2, reducing viral gene copies at later timepoints relative to control groups. This virus-specific pattern is consistent with experimental expectations, because the vaccine was designed primarily against H5 antigens. The Ct model reinforces this conclusion: vaccinated birds, particularly those receiving BAds-AIV, exhibit higher Ct values (lower viral loads) for H5N1, while H7N2 remains more refractory to the same vaccination regime.
>
> The significant interactions involving Route suggest that **delivery method modulates vaccine performance**, especially when combined with virus strain. Although Route alone did not affect log10GE, its interaction with both Virus and Vaccine_Group in the Ct model indicates that intranasal vs intramuscular administration may alter how effectively mucosal immunity is induced against specific viruses. Biologically, this implies that route optimization may be as important as antigen design when tuning adenoviral vector vaccines for different avian influenza strains.
>
> Additionally, Timepoint did not emerge as a strong main effect in either model, which likely reflects two features of the experiment: (i) viral load dynamics are non-linear and strain-specific, and (ii) the three sampled days (DPC2, DPC4, DPC6) may all lie on the plateau or decay phase of infection rather than capturing the full rise-and-fall trajectory. In that context, the more informative signal comes from how treatments re-shape viral loads within each virus and route across the sampled period, which is captured by the interaction terms and the mean-over-time plots.
>
> Methodologically, the mixed-effects structure with Bird_ID as a random intercept appropriately accounts for repeated measurements within birds and avoids inflating degrees of freedom. Residual checks suggest that the Gaussian assumption is adequate for these qPCR-derived outcomes; however, future work with larger sample sizes could explore alternative distributions (e.g., log-normal or Tweedie) and random-slope structures for time. Biologically, a natural extension would be to integrate data from other tissues (e.g., cloacal or oropharyngeal swabs) and immunological readouts (e.g., mucosal IgA, T-cell responses) into multivariate models. That would allow a more complete assessment of how bovine adenovirus-vectored vaccines modulate both viral shedding and host immunity across anatomical sites.
>
> Overall, this project shows that bovine adenovirus-vectored vaccines have measurable, strain-dependent effects on tracheal viral load, with the clearest protection against H5N1 and more limited impact on H7N2. The interaction patterns between virus, vaccine, and route highlight the importance of tailoring both antigen content and delivery strategies when designing mucosal vaccines for poultry.
